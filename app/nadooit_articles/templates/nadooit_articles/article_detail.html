{% extends "base.html" %}
{% load static %}

{% block title %}{{ article.title }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <article class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg overflow-hidden">
        <div class="p-8">
            <div class="flex justify-between items-start mb-6">
                <h1 class="text-4xl font-bold text-gray-900">{{ article.title }}</h1>
                {% if user == article.author %}
                <a href="{% url 'nadooit_articles:article_edit' article.slug %}" 
                   class="text-blue-500 hover:text-blue-700">
                    Edit Article
                </a>
                {% endif %}
            </div>

            <div class="text-gray-600 mb-8">
                <span>By {{ article.author.username }}</span>
                <span class="mx-2">â€¢</span>
                <span>{{ article.published_at|date:"F d, Y" }}</span>
            </div>

            <div class="prose max-w-none mb-8" id="article-content"
                 hx-get="{% url 'nadooit_articles:article_detail' article.slug %}"
                 hx-trigger="load once"
                 hx-target="#article-content"
                 hx-swap="innerHTML">
                Loading content...
            </div>

            <div class="flex items-center space-x-4 mb-8">
                {% include "nadooit_articles/partials/vote_buttons.html" %}
                <span class="text-gray-600">
                    {{ article.get_vote_count }} votes
                </span>
            </div>

            {% if user.is_authenticated %}
            <div class="mb-8">
                <h3 class="text-xl font-semibold mb-4">Add a Comment</h3>
                <form hx-post="{% url 'nadooit_articles:comment_create' article.id %}"
                      hx-target="#comments-list"
                      hx-swap="afterbegin"
                      class="space-y-4">
                    {% csrf_token %}
                    {{ comment_form.content }}
                    <button type="submit" 
                            class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                        Post Comment
                    </button>
                </form>
            </div>
            {% endif %}

            <div id="comments-list" class="space-y-6">
                {% for comment in comments %}
                    {% include "nadooit_articles/partials/comment.html" %}
                {% endfor %}
            </div>
        </div>
    </article>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.body.addEventListener('htmx:configRequest', function(evt) {
        // Add CSRF token to all HTMX requests
        evt.detail.headers['X-CSRFToken'] = '{{ csrf_token }}';
    });
</script>
{% endblock %}
